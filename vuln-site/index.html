<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechSpace | 開發者資源中心</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .hero-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 60px 0; margin-bottom: 30px; }
        .feature-card { transition: transform 0.3s; border: none; shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .feature-card:hover { transform: translateY(-5px); }
        .hidden-result { display: none; margin-top: 10px; padding: 10px; border-radius: 5px; background-color: #e9ecef; }
        #doc-content-area { white-space: pre-wrap; background: #2d2d2d; color: #ccc; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto; display: none;}
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="fas fa-code-branch"></i> TechSpace</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link active" href="#">首頁</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">專案列表</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">API 文件</a></li>
                </ul>
                <div class="d-flex">
                    <input class="form-control me-2" type="search" id="search-input" placeholder="搜尋專案..." aria-label="Search">
                    <button class="btn btn-outline-light" onclick="handleSearch()">搜尋</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-3">
        <div id="search-result-area"></div>
    </div>

    <div class="hero-section text-center">
        <div class="container">
            <h1 class="display-4">歡迎來到 TechSpace</h1>
            <p class="lead">企業級開發資源整合平台，連接您的所有專案與工具。</p>
        </div>
    </div>

    <div class="container">
        <div class="row">
            
            <div class="col-md-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-header bg-white text-primary fw-bold">
                        <i class="fas fa-user-lock"></i> 會員登入
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">請登入以存取內部資源。</p>
                        <form onsubmit="event.preventDefault(); handleLogin();">
                            <div class="mb-3">
                                <label class="form-label">帳號 / Email</label>
                                <input type="text" class="form-control" id="username" placeholder="admin">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">密碼</label>
                                <input type="password" class="form-control" id="password" placeholder="******">
                            </div>
                            <button type="submit" class="btn btn-primary w-100">登入系統</button>
                        </form>
                        <div id="login-status" class="mt-2 text-center small"></div>
                    </div>
                </div>
            </div>

            <div class="col-md-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-header bg-white text-success fw-bold">
                        <i class="fas fa-network-wired"></i> 連線測試工具
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">輸入網址以測試伺服器回應狀態</p>
                        <div class="input-group mb-3">
                            <span class="input-group-text">URL</span>
                            <input type="text" class="form-control" id="proxy-url" placeholder="http://example.com" value="http://google.com">
                        </div>
                        <button class="btn btn-outline-success w-100" onclick="handleProxy()">開始檢測</button>
                        <div id="proxy-status" class="hidden-result small"></div>
                    </div>
                </div>
            </div>

            <div class="col-md-4 mb-4">
                <div class="card feature-card h-100">
                    <div class="card-header bg-white text-warning fw-bold">
                        <i class="fas fa-file-alt"></i> 系統文件檢視
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">檢視平台相關文件。</p>
                        <div class="list-group">
                            <button class="list-group-item list-group-item-action" onclick="loadFile('LICENSE')">
                                <i class="fas fa-file-contract"></i> 檢視開源授權
                            </button>
                            <button class="list-group-item list-group-item-action" onclick="loadFile('README.md')">
                                <i class="fas fa-info-circle"></i> 檢視專案說明
                            </button>
                        </div>
                        
                        <hr>
                        <label class="form-label small text-danger">Debug 模式 (僅限開發者)：</label>
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" id="custom-filename" placeholder="輸入檔名..." value="requirements.txt">
                            <button class="btn btn-secondary" onclick="loadCustomFile()">讀取</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div id="doc-content-area"></div>
            </div>
        </div>
    </div>

    <footer class="text-center py-4 text-muted mt-5 border-top">
        <p class="mb-0">&copy; 2024 TechSpace Inc. All rights reserved.</p>
        <small>System Version 1.0.0 | <i class="fas fa-shield-alt"></i> Security Status: Unverified</small>
    </footer>

    <script>
        // [漏洞 1 & 4] SQL Injection & Brute Force
        async function handleLogin() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            const status = document.getElementById('login-status');
            
            status.innerHTML = '<span class="text-secondary"><i class="fas fa-spinner fa-spin"></i> 驗證中...</span>';

            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ username: u, password: p })
                });
                const data = await res.json();
                
                if(data.message === "Login successful") {
                    status.innerHTML = `<div class="alert alert-success py-1 mt-2">歡迎回來, ${data.role} (ID: ${data.user_id})</div>`;
                } else {
                    status.innerHTML = `<div class="alert alert-danger py-1 mt-2">帳號或密碼錯誤</div>`;
                }
            } catch(e) { status.innerText = "Error"; }
        }

        // [漏洞 2] XSS (Reflected)
        async function handleSearch() {
            const kw = document.getElementById('search-input').value;
            const area = document.getElementById('search-result-area');
            
            try {
                const res = await fetch('/api/search', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ keyword: kw })
                });
                // 直接將後端回傳的 HTML 塞入頁面，觸發 XSS
                const html = await res.text();
                area.innerHTML = `<div class="alert alert-info">搜尋完成：${html}</div>`;
            } catch(e) {}
        }

        // [漏洞 3] Path Traversal
        // 為了讓網站看起來正常，我們預設只提供 LICENSE 和 README
        // 但攻擊者(我們)可以手動輸入 app.py
        async function loadFile(filename) {
            fetchFile(filename);
        }

        async function loadCustomFile() {
            const filename = document.getElementById('custom-filename').value;
            fetchFile(filename);
        }

        async function fetchFile(name) {
            const area = document.getElementById('doc-content-area');
            area.style.display = 'block';
            area.innerText = "讀取中...";
            
            try {
                const res = await fetch(`/api/file?filename=${name}`);
                const text = await res.text();
                area.innerText = text;
            } catch(e) { area.innerText = "讀取失敗"; }
        }

        // [漏洞 6] SSRF
        async function handleProxy() {
            const url = document.getElementById('proxy-url').value;
            const status = document.getElementById('proxy-status');
            status.style.display = 'block';
            status.innerText = "檢測連線中...";

            try {
                const res = await fetch('/api/proxy', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ url: url })
                });
                const data = await res.json();
                status.innerHTML = `<strong>Status Code:</strong> ${data.status_code} <br> <strong>Preview:</strong> ${data.sample_content || ''}`;
            } catch(e) { status.innerText = "Request Failed"; }
        }
    </script>
</body>
</html>